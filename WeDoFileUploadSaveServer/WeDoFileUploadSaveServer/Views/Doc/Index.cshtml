<!--
 <form method="post" enctype="multipart/form-data" action="./upload">
    <label>key</label>
    <input type="text" name="key" value="f9093a0557c7a280e278916a27f04f37" />
    <br />
    <label>group</label>
    <input type="text" name="group" value="test" />
    <br />
    <input type="file" name="file" />
    <button type="submit">Enviar</button>
</form>
-->

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload API</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Highlight.js para syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            max-width: 1000px;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .api-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .api-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .form-section {
            padding: 2rem;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 0.75rem 1rem;
            transition: all 0.3s;
        }

            .form-control:focus {
                border-color: #0d6efd;
                box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
            }

        .btn-upload {
            background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }

            .btn-upload:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(13, 110, 253, 0.4);
            }

        .code-section {
            background: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 2rem;
        }

        .code-header {
            background: #2d2d2d;
            color: #ccc;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #404040;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .btn-copy {
            background: #404040;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

            .btn-copy:hover {
                background: #505050;
            }

            .btn-copy.copied {
                background: #28a745;
            }

        pre {
            margin: 0;
            padding: 1.5rem;
            overflow-x: auto;
        }

        .hljs {
            background: #1e1e1e;
            padding: 0;
        }

        .file-input-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s;
            background: #fafafa;
            cursor: pointer;
        }

            .file-input-area:hover {
                border-color: #0d6efd;
                background: #f0f7ff;
            }

        .file-preview {
            background: #e9ecef;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .endpoint-badge {
            background: #198754;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9rem;
            display: inline-block;
            margin-bottom: 1rem;
        }
    </style>

    <!-- endpoints-->
    <style>
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

            .card:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }

        pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
        }

        .badge {
            font-size: 0.8rem;
            padding: 0.3em 0.6em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="api-card">
            <!-- Header -->
            <div class="api-header">
                <h3 class="mb-1">
                    <i class="bi bi-cloud-upload me-2"></i>API Upload de Arquivos
                </h3>
                <p class="mb-0 opacity-75">Envie arquivos através de requisição POST multipart/form-data</p>
            </div>


            <div class="form-section">
                <!-- Endpoints Simples -->
<div class="mt-5">
    <h4 class="mb-4">
        <i class="bi bi-link-45deg me-2"></i>Endpoints da API
    </h4>

    <div class="row">
        <!-- Upload -->
        <div class="col-md-6 mb-4">
            <div class="card border-warning h-100">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-cloud-upload me-2"></i> Upload de Arquivo
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <span class="badge bg-warning">POST</span>
                        <code class="ms-2"><spam class="url-server-doc"></spam>/File/Upload</code>
                    </div>
                    
                    <h6>Descrição:</h6>
                    <p class="text-muted">Envia um arquivo para o servidor</p>
                    
                    <h6>Parâmetros:</h6>
                    <ul class="list-unstyled">
                        <li><code>api_key_server</code> - Chave de autenticação</li>
                        <li><code>project_name</code> - Nome do projeto</li>
                        <li><code>group</code> - Grupo do arquivo</li>
                        <li><code>file</code> - Arquivo a ser enviado</li>
                    </ul>

                    <h6>Exemplo cURL:</h6>
                    <pre class="bg-light p-2 rounded">
                        <code>
using Newtonsoft.Json;
using System.Net.Http.Headers;

private class WeDoFileUploadSaveServerResponse
{
    public bool Success { get; set; }
    public string? Message { get; set; }
    public string? File_name { get; set; }
};

[HttpPost]
private async Task<WeDoFileUploadSaveServerResponse> SaveFromWeDoFileUploadSaveServer(IFormFile file)
{
    try
    {
        const string URL_SERVER = "<spam class="url-server-doc"></spam>";
        const string API_KEY_SERVER = "key_7194f9c8-61c2-4ba6-8c47-aec4cd70ed53";
        const string PROJECT_NAME = "QA_WeDoFile";
        const string GROUP = "development";

        using var client = new HttpClient();
        using var content = new MultipartFormDataContent();
        using var fileStream = file.OpenReadStream();
        var fileContent = new StreamContent(fileStream);
        fileContent.Headers.ContentType = new MediaTypeHeaderValue(file.ContentType);

        content.Add(fileContent, "file", file.FileName);

        var response = await client.PostAsync(
            $"{URL_SERVER}/File/Upload?project_name={PROJECT_NAME}&group={GROUP}&api_key_server={API_KEY_SERVER}",
            content
        );

        response.EnsureSuccessStatusCode();
        var responseBody = await response.Content.ReadAsStringAsync();
        return JsonConvert.DeserializeObject<WeDoFileUploadSaveServerResponse>(responseBody)
            ?? new WeDoFileUploadSaveServerResponse();
    }
    catch (Exception ex)
    {
        var exception = new WeDoFileUploadSaveServerResponse();
        exception.Message = ex.Message;
        return exception;
    }
}

WeDoFileUploadSaveServerResponse weDoFileUploadSaveServerResponse = await SaveFromWeDoFileUploadSaveServer(enderecoViewModel.comprovanteDeEndereco);

                        </code>
                    </pre>

                   <h6>Resposta de Sucesso - JSON:</h6>
                    <pre class="bg-light p-2 rounded">
                        <code>
{
    "success": true,
    "message": "OPERATION_COMPLETED_SUCCESSFULLY",
    "file_name": "8b860d6a9eab4db48d8993814bde8d91d457e95d25954483a8c5cc96dd16da79"
}
                        </code>
                    </pre>

                </div>
            </div>
        </div>

        <!-- Visualização -->
        <div class="col-md-6 mb-4">
            <div class="card border-success h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-eye"></i> Visualização do Arquivo
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                                        <span class="badge bg-success">GET</span>
                        <code class="ms-2"><spam class="url-server-doc"></spam>/File/Get/{file_name}</code>
                    </div>
                    
                    <h6>Descrição:</h6>
                    <p class="text-muted">Visualizar arquivo pelo nome</p>
                    
                    <h6>Parâmetros:</h6>
                    <ul class="list-unstyled">
                        <li><code>file_name </code> - Nome do arquivo</li>
                    </ul>

                    <h6>Exemplo cURL:</h6>
                    <pre class="bg-light p-2 rounded">
                        <code>
curl --location '<spam class="url-server-doc"></spam>/File/Get/686d96a7bfc34532844f2d79fc263bd12bd7bcf1617548888d7614f9bf1b7499'
                        </code>
                    </pre>

                    <h6>Resposta de Sucesso:</h6>
                    <pre class="bg-light p-2 rounded">
                        <code>
HTTP/1.1 200 OK
→ binário puro:
ÿØÿÛC
                        </code>
                    </pre>

                </div>
            </div>
        </div>


        <div class="col-md-6 mb-4">
            <div class="card border-danger h-100">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-trash"></i> Deletar Arquivo
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <span class="badge bg-danger">DELETE</span>
                        <code class="ms-2"><spam class="url-server-doc"></spam>/File/Delete/{file_name}</code>
                    </div>

                    <h6>Descrição:</h6>
                    <p class="text-muted">Deletar um arquivo pelo nome</p>

                    <h6>Parâmetros:</h6>
                    <ul class="list-unstyled">
                        <li><code>file_name</code> - Nome do arquivo</li>
                        <li><code>api_key_server </code> - Chave de autenticação</li>
                    </ul>

                    <h6>Exemplo C# - HttpClient:</h6>
                    <pre class="bg-light p-2 rounded">
                        <code>
var client = new HttpClient();
var request = new HttpRequestMessage(HttpMethod.Delete, "<spam class="url-server-doc"></spam>/File/Delete?file_name=557fabc8617248df9a77b7b4bdb57cff4fc101c2f47a44c7b6e88aa1d44b3174");
request.Headers.Add("api_key_server", "key_7194f9c8-61c2-4ba6-8c47-aec4cd70ed53");
var response = await client.SendAsync(request);
response.EnsureSuccessStatusCode();
Console.WriteLine(await response.Content.ReadAsStringAsync());
                        </code>
                    </pre>

                    <h6>Resposta de Sucesso - JSON:</h6>
                    <pre class="bg-light p-2 rounded">
                        <code>
{
    "success": true,
    "message": "FILE_DELETE_SUCCESS"
}
                        </code>
                    </pre>
                    </div>
            </div>
        </div>





    </div>
</div>
            <div/>

            <!-- Form Section -->
            <div class="form-section">
                <div class="endpoint-badge">POST /upload</div>

                <form method="post" enctype="multipart/form-data" action="../File/Upload" id="uploadForm">
                    <!-- Key Field -->
                    <div class="row mb-4">

                        <div class="col-md-6">
                            <label class="form-label">
                                <i class="bi bi-key me-1"></i>API Key Server
                            </label>
                            <input type="text"
                                   name="api_key_server"
                                   class="form-control"
                                   value="key_7194f9c8-61c2-4ba6-8c47-aec4cd70ed53"
                                   placeholder="Sua chave de API"
                                   required>
                            <div class="form-text">
                                Chave de autenticação para acesso à API
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">
                                <i class="bi bi-key me-1"></i>Nome do projeto  ProjectName
                            </label>
                            <input type="text"
                                   name="project_name"
                                   class="form-control"
                                   value="QA_WeDoFile"
                                   placeholder="Sua chave de API"
                                   required>
                            <div class="form-text">
                                Chave de acesso para seu arquivo
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">
                                <i class="bi bi-folder me-1"></i>Group
                            </label>
                            <input type="text"
                                   name="group"
                                   class="form-control"
                                   value="development"
                                   placeholder="Nome do grupo">
                            <div class="form-text">
                                Categoria para organização dos arquivos
                            </div>
                        </div>

                    </div>

                    <!-- File Upload -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <label class="form-label">
                                <i class="bi bi-file-earmark-arrow-up me-1"></i>Arquivo
                            </label>

                            <div class="file-input-area" id="dropArea" onclick="document.getElementById('fileInput').click()">
                                <div class="mb-3">
                                    <i class="bi bi-cloud-arrow-up display-4 text-secondary"></i>
                                </div>
                                <h5>Clique para selecionar um arquivo</h5>
                                <p class="text-muted mb-3">ou arraste e solte aqui</p>

                                <input type="file"
                                       name="file"
                                       id="fileInput"
                                       class="d-none"
                                       onchange="updateFilePreview()"
                                       required>

                                <div class="mt-3">
                                    <small class="text-muted">
                                        Tamanho máximo: 10MB
                                    </small>
                                </div>
                            </div>

                            <!-- File Preview -->
                            <div id="filePreview" class="d-none">
                                <div class="file-preview">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-file-earmark-text fs-4 me-3"></i>
                                        <div class="flex-grow-1">
                                            <strong id="fileName">Nome do arquivo</strong>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small id="fileSize">Tamanho do arquivo</small>
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearFile()">
                                                    <i class="bi bi-trash"></i> Remover
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-flex justify-content-end">
                        <button type="submit" class="btn btn-upload">
                            <i class="bi bi-send me-2"></i>Enviar Arquivo
                        </button>
                    </div>
                </form>

    

            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <!-- C# syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/csharp.min.js"></script>

    <script>
        // Inicializar highlight.js
        hljs.highlightAll();

        // Atualizar preview do arquivo
        function updateFilePreview() {
            const fileInput = document.getElementById('fileInput');
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                filePreview.classList.remove('d-none');
            }
        }

        // Limpar seleção de arquivo
        function clearFile() {
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreview').classList.add('d-none');
        }

        // Formatar tamanho do arquivo
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Drag and drop
        const dropArea = document.getElementById('dropArea');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.style.borderColor = '#0d6efd';
            dropArea.style.background = '#f0f7ff';
        }

        function unhighlight() {
            dropArea.style.borderColor = '#dee2e6';
            dropArea.style.background = '#fafafa';
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                updateFilePreview();
            }
        }

        // Copiar código C# principal
        function copyCode() {
            const code = document.getElementById('codeExample').textContent;
            copyToClipboard(code, 'btn-copy');
        }

        // Copiar código do Controller
        function copyControllerCode() {
            const code = document.getElementById('controllerCode').textContent;
            copyToClipboard(code, 'btn-copy:nth-of-type(2)');
        }

        // Função genérica para copiar
        function copyToClipboard(text, buttonSelector) {
            navigator.clipboard.writeText(text).then(() => {
                const button = document.querySelector(buttonSelector);
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="bi bi-check2 me-1"></i>Copiado!';
                button.classList.add('copied');

                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        // Form submission
        document.getElementById('uploadForm').addEventListener('submit', function (e) {
            const fileInput = document.getElementById('fileInput');

            if (!fileInput.files[0]) {
                e.preventDefault();
                alert('Por favor, selecione um arquivo para upload.');
                return;
            }

            // Opcional: mostrar loading
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Enviando...';
            submitBtn.disabled = true;

            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 3000);
        });
    </script>


    <!-- Visualização -->
    <script>
            let urlServerDoc = window.location.origin;

            document.querySelectorAll(".url-server-doc")
            .forEach(
                (element) =>
                        element.textContent = urlServerDoc);
    </script>
</body>
</html>

